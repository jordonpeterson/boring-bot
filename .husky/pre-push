#!/bin/sh

# Lint changed files on push — auto-fix only, never block.

REMOTE_REF=$(git rev-parse --abbrev-ref --symbolic-full-name @{upstream} 2>/dev/null)

if [ -z "$REMOTE_REF" ] || ! git rev-parse "$REMOTE_REF" >/dev/null 2>&1; then
  # No upstream or remote ref doesn't exist yet (first push) — skip
  exit 0
fi

FILES=$(git diff --name-only "$REMOTE_REF"...HEAD -- '*.ts' '*.js' '*.mts' '*.mjs' 2>/dev/null || true)

if [ -z "$FILES" ]; then
  exit 0
fi

echo "$FILES" | xargs npx eslint --fix --no-warn-ignored >/dev/null 2>&1 || true

exit 0
